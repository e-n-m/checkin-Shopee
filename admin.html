<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin • Check-in HUB</title>
  <link rel="icon" href="data:image/x-icon;base64,AAABAAEAICACAAEAAQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAA==">
  <style>
    :root{--terracota:#EE5A36;--terracota-dk:#cf4d2f;--bg:#f5f6f8;--card:#fff;--txt:#1b1d22}
    body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{background:#0b1324;color:#fff;padding:12px 16px;display:flex;align-items:center;gap:10px}
    header img{height:20px;border-radius:6px}
    main{max-width:1000px;margin:24px auto;padding:0 14px}
    .card{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.08);margin-bottom:16px}
    input,button{padding:10px 12px;border-radius:10px;border:1px solid #e6e8ef}
    button{cursor:pointer;font-weight:700}
    .btn{background:var(--terracota);color:#fff;border:0}
    .btn:hover{background:var(--terracota-dk)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eef}
    code,pre{background:#f7f8fb;padding:8px;border-radius:8px}
    .muted{color:#788}
  </style>
</head>
<body>
<header>
  <img src="./shopito.svg" alt="Shopito">
  <strong>Admin • Check-in HUB</strong>
</header>
<main>
  <section class="card">
    <h3>PIN de administrador</h3>
    <p class="muted">Use o PIN para liberar troca de aparelho e exportar logs.</p>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <input id="pin" type="password" placeholder="Digite o PIN" />
      <button class="btn" id="okPin">Entrar</button>
      <span id="authState" class="muted"></span>
    </div>
    <p class="muted">PIN atual (edite no código): <code id="pinShown"></code></p>
  </section>

  <section class="card" id="devSec" style="display:none">
    <h3>Vínculo de aparelho (antifraude)</h3>
    <p class="muted">Cada navegador gera um <em>DEVICE_ID</em>. Você pode <b>apagar o vínculo</b> local para testar a troca e/ou liberar manualmente.</p>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <button id="showDev" class="">Ver DEVICE_ID atual</button>
      <button id="clearDev" class="">Apagar meu DEVICE_ID (este navegador)</button>
      <span id="devOut" class="muted"></span>
    </div>
    <p class="muted">A liberação efetiva para produção deve ser feita no backend/planilha; aqui é uma simulação local.</p>
  </section>

  <section class="card" id="logSec" style="display:none">
    <h3>Registros de Check-in (armazenados no navegador do motorista)</h3>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="dump"  class="btn">Baixar CSV</button>
      <button id="clear" class="">Limpar logs</button>
      <span id="logInfo" class="muted"></span>
    </div>
    <pre id="peek" style="margin-top:10px;max-height:200px;overflow:auto"></pre>
  </section>

  <section class="card">
    <h3>Dicas rápidas</h3>
    <ul>
      <li>Base de motoristas vem de <code>drivers.csv</code> na raiz do repositório.</li>
      <li>IDs são normalizados (remove <code>.0</code> e caracteres não numéricos).</li>
      <li>Logs ficam em <code>localStorage.hub_logs</code> no navegador do motorista.</li>
    </ul>
  </section>
</main>

<script>
/* ======== CONFIG ======== */
const ADMIN_PIN = '2025'; // <<< ALTERE O PIN AQUI

/* ======== Helpers ======== */
function devId(){
  const k='hub_device_id';
  let id = localStorage.getItem(k);
  if (!id){
    const a = crypto.getRandomValues(new Uint8Array(16));
    a[6]=(a[6]&0x0f)|0x40; a[8]=(a[8]&0x3f)|0x80;
    id = Array.from(a,(v,i)=>(i===4||i===6||i===8||i===10?'-':'')+v.toString(16).padStart(2,'0')).join('');
    localStorage.setItem(k,id);
  }
  return id;
}
function download(filename, text){
  const blob = new Blob([text], {type:'text/csv;charset=utf-8'});
  const url  = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download=filename; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}

/* ======== Auth PIN ======== */
document.getElementById('pinShown').textContent = ADMIN_PIN;
let authed = false;
document.getElementById('okPin').onclick = ()=>{
  const v = document.getElementById('pin').value.trim();
  authed = (v === ADMIN_PIN);
  document.getElementById('authState').textContent = authed ? 'OK (acesso liberado)' : 'PIN incorreto';
  document.getElementById('devSec').style.display = authed ? '' : 'none';
  document.getElementById('logSec').style.display = authed ? '' : 'none';
};

/* ======== Dispositivo ======== */
document.getElementById('showDev').onclick = ()=>{
  document.getElementById('devOut').textContent = devId();
};
document.getElementById('clearDev').onclick = ()=>{
  localStorage.removeItem('hub_device_id');
  localStorage.removeItem('hub_device_info');
  document.getElementById('devOut').textContent = 'Apagado
